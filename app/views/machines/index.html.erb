<section id="dashboard">
  <div class="container">
    <h2 class="section-heading text-uppercase">Dashboard</h2>
  </div>
  <div id="map" style="width: 100%; height: 350px;"></div>
  <br>
  <div class="container">
    <div style="display: flex; justify-content: space-between;">
      <h3 class="section-heading">Status Summary</h3>
      <%= link_to new_machine_path do %>
        <button class="btn btn-success">Register new machine</button>
      <% end %>
    </div>
    <br>
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Id</th>
          <th>Location</th>
          <th class="text-center">Model</th>
          <th class="text-center">Firmware</th>
          <th class="text-center">Status</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @machines.sample(5).each do |machine| %>
        <tr>
          <th scope="row">
            <%= link_to machine_path(machine.id) do %>
              <%= machine.id %>
            <% end %>
            </th>
          <td>
            <%= link_to machine_path(machine.id) do %>
              <%= machine.address %>
            <% end %>
          </td>
          <td class="text-center">DEX 9.23</td>
          <td class="text-center">MX985</td>
          <td class="text-center"><i class="fa fa-circle" aria-hidden="true"></i></td>
          <td class="text-center">
          <div class="btn-group">
            <button type="button" class="btn btn-default">Details</button>
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="caret"></span>
              <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li><a href="#">Complete Report</a></li>
              <li role="separator" class="divider"></li>
              <li><%= link_to "Edit", edit_machine_path(machine.id)%></li>
              <li><%= link_to "Retire machine", machine_path(machine.id), method: :delete %></li>
              <li><a href="#">QR Code</a></li>
            </ul>
          </div>
          </td>
        </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</section>

<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    var handler = Gmaps.build('Google');
    handler.buildMap({ internal: { id: 'map' } }, function() {
      markers = handler.addMarkers(<%= raw @hash.to_json %>);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
        if (markers.length == 0) {
          handler.getMap().setZoom(2);
        } else if (markers.length == 1) {
          handler.getMap().setZoom(14);
        }
    });
  <% end %>
<% end %>
